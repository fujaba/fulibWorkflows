- c: 	org.fulib.classmodel.ClassModel
  classes: 	testPartyApp
  defaultCollectionType: 	c1
  defaultPropertyStyle: 	Bean
  defaultRoleType: 	"java.util.ArrayList<%s>"
  mainJavaDir: 	"test/src/test/java"
  packageName: 	uks.debuggen.party
  packageSrcFolder: 	"test/src/test/java/uks/debuggen/party"

- testPartyApp: 	org.fulib.classmodel.Clazz
  attributes: 	testPartyApp_eventBroker
  importList: 	"import org.junit.Test;" 	"import uks.debuggen.party.events.*;" 	"import uks.debuggen.party.PartyApp.PartyAppService;" 	"import org.fulib.yaml.Yaml;" 	"import com.mashape.unirest.http.HttpResponse;" 	"import com.mashape.unirest.http.Unirest;" 	"import com.mashape.unirest.http.exceptions.UnirestException;" 	"import static com.codeborne.selenide.Selenide.open;" 	"import static com.codeborne.selenide.Selenide.$;" 	"import static com.codeborne.selenide.Condition.text;" 	"import static com.codeborne.selenide.Condition.matchText;" 	"import com.codeborne.selenide.SelenideElement;"
  imports: 	"import org.junit.Test;" 	"import uks.debuggen.party.events.*;" 	"import uks.debuggen.party.PartyApp.PartyAppService;" 	"import org.fulib.yaml.Yaml;" 	"import com.mashape.unirest.http.HttpResponse;" 	"import com.mashape.unirest.http.Unirest;" 	"import com.mashape.unirest.http.exceptions.UnirestException;" 	"import static com.codeborne.selenide.Selenide.open;" 	"import static com.codeborne.selenide.Selenide.$;" 	"import static com.codeborne.selenide.Condition.text;" 	"import static com.codeborne.selenide.Condition.matchText;" 	"import com.codeborne.selenide.SelenideElement;"
  methods: 	testPartyApp_PartyApp 	testPartyApp_publish
  model: 	c
  modified: 	false
  name: 	TestPartyApp
  propertyStyle: 	Bean

- c1: 	org.fulib.classmodel.CollectionType
  implClass: 	class java.util.ArrayList
  implTemplate: 	"java.util.ArrayList<%s>"
  itf: 	org.fulib.classmodel.CollectionInterface.List
  qualifiedImplName: 	java.util.ArrayList
  simpleImplName: 	ArrayList

- testPartyApp_eventBroker: 	org.fulib.classmodel.Attribute
  clazz: 	testPartyApp
  id: 	TestPartyApp_eventBroker
  modified: 	false
  name: 	eventBroker
  propertyStyle: 	Bean
  type: 	EventBroker
  typeSignature: 	EventBroker

- testPartyApp_PartyApp: 	org.fulib.classmodel.FMethod
  annotations: 	"@Test"
  clazz: 	testPartyApp
  declaration: 	"@Test
public void PartyApp()"
  id: 	TestPartyApp_PartyApp
  methodBody: 	"// start the event broker
eventBroker = new EventBroker();
eventBroker.start();

// start service
PartyAppService partyApp = new PartyAppService();
partyApp.start();

open(\"http://localhost:42000\");
$(\"body\").shouldHave(text(\"event broker\"));

SelenideElement pre = $(\"pre\");
pre.shouldHave(text(\"http://localhost:42001/apply\"));

// workflow Overview
// create UserRegisteredEvent: user registered 12:00
UserRegisteredEvent e1200 = new UserRegisteredEvent();
e1200.setId(\"12:00\");
publish(e1200);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_00:\"));

// create LoginSucceededEvent: login succeeded 13:00
LoginSucceededEvent e1300 = new LoginSucceededEvent();
e1300.setId(\"13:00\");
publish(e1300);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_00:\"));

// create PartyCreatedEvent: party created 14:00
PartyCreatedEvent e1400 = new PartyCreatedEvent();
e1400.setId(\"14:00\");
publish(e1400);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_00:\"));

// create ItemBookedEvent: item booked 15:00
ItemBookedEvent e1500 = new ItemBookedEvent();
e1500.setId(\"15:00\");
publish(e1500);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 15_00:\"));

// create SaldiComputedEvent: saldi computed 16:00
SaldiComputedEvent e1600 = new SaldiComputedEvent();
e1600.setId(\"16:00\");
publish(e1600);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 16_00:\"));

// workflow RegisterNewUser
// page 12:00
open(\"http://localhost:42001/page/12_00\");
$(\"#name\").setValue(\"Alice\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_01:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_01:\"));

// page 12:05
open(\"http://localhost:42001/page/12_05\");
$(\"#email\").setValue(\"a@b.de\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_04:\"));

// page 12:06
open(\"http://localhost:42001/page/12_06\");
$(\"#password\").setValue(\"secret\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_07:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_07:\"));
// check data note 12:07:01
pre = $(\"#data\");
pre.shouldHave(text(\"- Alice:\"));
pre.shouldHave(matchText(\"name:.*Alice\"));
pre.shouldHave(matchText(\"email:.*a@b.de\"));
pre.shouldHave(matchText(\"password:.*secret\"));

// page 12:11
open(\"http://localhost:42001/page/12_11\");
$(\"#party\").setValue(\"SE BBQ\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_12:\"));

// workflow LoginOldUser
// page 13:00
open(\"http://localhost:42001/page/13_00\");
$(\"#name\").setValue(\"Alice\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_01:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_01:\"));

// page 13:06
open(\"http://localhost:42001/page/13_06\");
$(\"#password\").setValue(\"secret\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_07:\"));

// page 13:11
open(\"http://localhost:42001/page/13_11\");
$(\"#party\").setValue(\"SE BBQ\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_12:\"));

// workflow StartParty
// page 14:00
open(\"http://localhost:42001/page/14_00\");
$(\"#party\").setValue(\"SE BBQ\");
$(\"#location\").setValue(\"Uni\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_01:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_01:\"));
// check data note 14:02
pre = $(\"#data\");
pre.shouldHave(text(\"- sE_BBQ:\"));
pre.shouldHave(matchText(\"name:.*\\"SE BBQ\\"\"));
pre.shouldHave(matchText(\"location:.*Uni\"));

// page 14:10
open(\"http://localhost:42001/page/14_10\");
$(\"#add\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_11:\"));

// page 14:12
open(\"http://localhost:42001/page/14_12\");
$(\"#item\").setValue(\"beer\");
$(\"#price\").setValue(\"12.00\");
$(\"#buyer\").setValue(\"Bob\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_13:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_13:\"));
// check data note 14:14
pre = $(\"#data\");
pre.shouldHave(text(\"- beer:\"));
pre.shouldHave(matchText(\"name:.*beer\"));
pre.shouldHave(matchText(\"price:.*12.00\"));
pre.shouldHave(matchText(\"buyer:.*sE_BBQ_Bob\"));
pre.shouldHave(matchText(\"party:.*sE_BBQ\"));
// check data note 14:15
pre = $(\"#data\");
pre.shouldHave(text(\"- sE_BBQ_Bob:\"));
pre.shouldHave(matchText(\"name:.*Bob\"));
pre.shouldHave(matchText(\"party:.*sE_BBQ\"));

// page 14:20
open(\"http://localhost:42001/page/14_20\");
$(\"#add\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_21:\"));

// page 14:22
open(\"http://localhost:42001/page/14_22\");
$(\"#item\").setValue(\"meat\");
$(\"#price\").setValue(\"21.00\");
$(\"#buyer\").setValue(\"Alice\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_23:\"));

// check PartyApp
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 14_23:\"));
// check data note 14:24
pre = $(\"#data\");
pre.shouldHave(text(\"- meat:\"));
pre.shouldHave(matchText(\"name:.*meat\"));
pre.shouldHave(matchText(\"price:.*21.00\"));
pre.shouldHave(matchText(\"buyer:.*sE_BBQ_Alice\"));
pre.shouldHave(matchText(\"party:.*sE_BBQ\"));
// check data note 14:25
pre = $(\"#data\");
pre.shouldHave(text(\"- sE_BBQ_Alice:\"));
pre.shouldHave(matchText(\"name:.*Alice\"));
pre.shouldHave(matchText(\"expenses:.*0.00\"));
pre.shouldHave(matchText(\"party:.*sE_BBQ\"));

// page 14:30
open(\"http://localhost:42001/page/14_30\");

System.out.println();
"
  modified: 	false
  modifiers: 	public
  name: 	PartyApp
  paramsString: 	""
  returnType: 	void
  signature: 	"class/TestPartyApp/method/PartyApp()"

- testPartyApp_publish: 	org.fulib.classmodel.FMethod
  annotations: 	""
  clazz: 	testPartyApp
  declaration: 	"public void publish(Event event)"
  id: 	TestPartyApp_publish
  methodBody: 	"String yaml = Yaml.encode(event);

try {
   HttpResponse<String> response = Unirest.post(\"http://localhost:42000/publish\")
         .body(yaml)
         .asString();
}
catch (UnirestException e) {
   e.printStackTrace();
}"
  modified: 	false
  modifiers: 	public
  name: 	publish
  paramsString: 	"Event event"
  returnType: 	void
  signature: 	"class/TestPartyApp/method/publish(Event)"

