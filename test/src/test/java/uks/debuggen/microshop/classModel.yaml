- c: 	org.fulib.classmodel.ClassModel
  classes: 	testMicroShop
  defaultCollectionType: 	c1
  defaultPropertyStyle: 	Bean
  defaultRoleType: 	"java.util.ArrayList<%s>"
  mainJavaDir: 	"test/src/test/java"
  packageName: 	uks.debuggen.microshop
  packageSrcFolder: 	"test/src/test/java/uks/debuggen/microshop"

- testMicroShop: 	org.fulib.classmodel.Clazz
  attributes: 	testMicroShop_eventBroker
  importList: 	"import org.junit.Test;" 	"import java.util.LinkedHashMap;" 	"import uks.debuggen.microshop.events.*;" 	"import uks.debuggen.microshop.Warehouse.WarehouseService;" 	"import uks.debuggen.microshop.MicroShop.MicroShopService;" 	"import org.fulib.yaml.Yaml;" 	"import com.mashape.unirest.http.HttpResponse;" 	"import com.mashape.unirest.http.Unirest;" 	"import com.mashape.unirest.http.exceptions.UnirestException;" 	"import static com.codeborne.selenide.Selenide.open;" 	"import static com.codeborne.selenide.Selenide.$;" 	"import static com.codeborne.selenide.Condition.text;" 	"import static com.codeborne.selenide.Condition.matchText;" 	"import com.codeborne.selenide.SelenideElement;"
  imports: 	"import org.junit.Test;" 	"import java.util.LinkedHashMap;" 	"import uks.debuggen.microshop.events.*;" 	"import uks.debuggen.microshop.Warehouse.WarehouseService;" 	"import uks.debuggen.microshop.MicroShop.MicroShopService;" 	"import org.fulib.yaml.Yaml;" 	"import com.mashape.unirest.http.HttpResponse;" 	"import com.mashape.unirest.http.Unirest;" 	"import com.mashape.unirest.http.exceptions.UnirestException;" 	"import static com.codeborne.selenide.Selenide.open;" 	"import static com.codeborne.selenide.Selenide.$;" 	"import static com.codeborne.selenide.Condition.text;" 	"import static com.codeborne.selenide.Condition.matchText;" 	"import com.codeborne.selenide.SelenideElement;"
  methods: 	testMicroShop_MicroShop 	testMicroShop_publish
  model: 	c
  modified: 	false
  name: 	TestMicroShop
  propertyStyle: 	Bean

- c1: 	org.fulib.classmodel.CollectionType
  implClass: 	class java.util.ArrayList
  implTemplate: 	"java.util.ArrayList<%s>"
  itf: 	org.fulib.classmodel.CollectionInterface.List
  qualifiedImplName: 	java.util.ArrayList
  simpleImplName: 	ArrayList

- testMicroShop_eventBroker: 	org.fulib.classmodel.Attribute
  clazz: 	testMicroShop
  id: 	TestMicroShop_eventBroker
  modified: 	false
  name: 	eventBroker
  propertyStyle: 	Bean
  type: 	EventBroker
  typeSignature: 	EventBroker

- testMicroShop_MicroShop: 	org.fulib.classmodel.FMethod
  annotations: 	"@Test"
  clazz: 	testMicroShop
  declaration: 	"@Test
public void MicroShop()"
  id: 	TestMicroShop_MicroShop
  methodBody: 	"// start the event broker
eventBroker = new EventBroker();
eventBroker.start();

// start service
WarehouseService warehouse = new WarehouseService();
warehouse.start();

// start service
MicroShopService microShop = new MicroShopService();
microShop.start();
try {
   Thread.sleep(1500);
} catch (Exception e) {
}

open(\"http://localhost:42000\");
$(\"body\").shouldHave(text(\"event broker\"));

SelenideElement pre = $(\"pre\");
pre.shouldHave(text(\"http://localhost:42001/apply\"));
pre.shouldHave(text(\"http://localhost:42002/apply\"));
LinkedHashMap<String, Object> modelMap;

// workflow SmoothCase

// page 12:01
open(\"http://localhost:42001/page/12_01\");

// page 12:02
open(\"http://localhost:42001/page/12_02\");
$(\"#barcode\").setValue(\"b001\");
$(\"#type\").setValue(\"red shoes\");
$(\"#location\").setValue(\"shelf 42\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_02_01:\"));

// check Warehouse
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_02_01:\"));
for (DataEvent dataEvent : warehouse.getBuilder().getEventStore().values()) {
   warehouse.getBuilder().load(dataEvent.getBlockId());
}
modelMap = warehouse.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/warehouse12_02_01.svg\", modelMap.values());
}

open(\"http://localhost:42001\");
// check data note 12:02:02
pre = $(\"#data\");
pre.shouldHave(text(\"- b001:\"));
pre.shouldHave(matchText(\"barcode:.*b001\"));
pre.shouldHave(matchText(\"content:.*red.shoes\"));
pre.shouldHave(matchText(\"location:.*shelf.42\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_02_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_02_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:03:01
pre = $(\"#data\");
pre.shouldHave(text(\"- red_shoes:\"));
pre.shouldHave(matchText(\"name:.*red.shoes\"));
pre.shouldHave(matchText(\"state:.*in.stock\"));

// page 12:04
open(\"http://localhost:42001/page/12_04\");

// page 12:05
open(\"http://localhost:42001/page/12_05\");
$(\"#barcode\").setValue(\"b002\");
$(\"#type\").setValue(\"red shoes\");
$(\"#location\").setValue(\"shelf 23\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_05_01:\"));

// check Warehouse
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_05_01:\"));
for (DataEvent dataEvent : warehouse.getBuilder().getEventStore().values()) {
   warehouse.getBuilder().load(dataEvent.getBlockId());
}
modelMap = warehouse.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/warehouse12_05_01.svg\", modelMap.values());
}

open(\"http://localhost:42001\");
// check data note 12:05:02
pre = $(\"#data\");
pre.shouldHave(text(\"- b002:\"));
pre.shouldHave(matchText(\"barcode:.*b002\"));
pre.shouldHave(matchText(\"content:.*red.shoes\"));
pre.shouldHave(matchText(\"location:.*shelf.23\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_05_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_05_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:06:01
pre = $(\"#data\");
pre.shouldHave(text(\"- red_shoes:\"));
pre.shouldHave(matchText(\"name:.*red.shoes\"));
pre.shouldHave(matchText(\"state:.*in.stock\"));

// page 12:07
open(\"http://localhost:42001/page/12_07\");

// page 12:08
open(\"http://localhost:42001/page/12_08\");
$(\"#barcode\").setValue(\"b003\");
$(\"#type\").setValue(\"blue jeans\");
$(\"#location\").setValue(\"shelf 1337\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_08_01:\"));

// check Warehouse
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_08_01:\"));
for (DataEvent dataEvent : warehouse.getBuilder().getEventStore().values()) {
   warehouse.getBuilder().load(dataEvent.getBlockId());
}
modelMap = warehouse.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/warehouse12_08_01.svg\", modelMap.values());
}

open(\"http://localhost:42001\");
// check data note 12:08:02
pre = $(\"#data\");
pre.shouldHave(text(\"- b003:\"));
pre.shouldHave(matchText(\"barcode:.*b003\"));
pre.shouldHave(matchText(\"content:.*blue.jeans\"));
pre.shouldHave(matchText(\"location:.*shelf.1337\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_08_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_08_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:09:01
pre = $(\"#data\");
pre.shouldHave(text(\"- blue_jeans:\"));
pre.shouldHave(matchText(\"name:.*blue.jeans\"));
pre.shouldHave(matchText(\"state:.*in.stock\"));

// page 12:10
open(\"http://localhost:42001/page/12_10\");

// page 12:11
open(\"http://localhost:42002/page/12_11\");

// page 12:12
open(\"http://localhost:42002/page/12_12\");
$(\"#product\").setValue(\"red shoes\");
$(\"#price\").setValue(\"$42\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_14_42:\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_14_42:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_14_42.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:14:43
pre = $(\"#data\");
pre.shouldHave(text(\"- red_shoes:\"));
pre.shouldHave(matchText(\"name:.*red.shoes\"));
pre.shouldHave(matchText(\"price:.*.42\"));

// page 12:16
open(\"http://localhost:42002/page/12_16\");

// page 12:17
open(\"http://localhost:42002/page/12_17\");
$(\"#product\").setValue(\"blue jeans\");
$(\"#price\").setValue(\"$63\");
$(\"#ok\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_17_01:\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_17_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_17_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:17:02
pre = $(\"#data\");
pre.shouldHave(text(\"- blue_jeans:\"));
pre.shouldHave(matchText(\"name:.*blue.jeans\"));
pre.shouldHave(matchText(\"price:.*.63\"));

// page 12:19
open(\"http://localhost:42002/page/12_19\");

// page 12:20
open(\"http://localhost:42002/page/12_20\");

// page 12:21
open(\"http://localhost:42002/page/12_21\");
$(\"#product\").setValue(\"red shoes\");
$(\"#customer\").setValue(\"Carli Customer\");
$(\"#address\").setValue(\"Wonderland 1\");
$(\"#buy\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_21_01:\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_21_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_21_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:23:01
pre = $(\"#data\");
pre.shouldHave(text(\"- o0925_1:\"));
pre.shouldHave(matchText(\"code:.*o0925_1\"));
pre.shouldHave(matchText(\"state:.*picking\"));

// check Warehouse
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_21_01:\"));
for (DataEvent dataEvent : warehouse.getBuilder().getEventStore().values()) {
   warehouse.getBuilder().load(dataEvent.getBlockId());
}
modelMap = warehouse.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/warehouse12_21_01.svg\", modelMap.values());
}

open(\"http://localhost:42001\");
// check data note 12:22:01
pre = $(\"#data\");
pre.shouldHave(text(\"- pt_o0925_1:\"));
pre.shouldHave(matchText(\"code:.*pt_o0925_1\"));
pre.shouldHave(matchText(\"product:.*red.shoes\"));
pre.shouldHave(matchText(\"shelf:.*shelf.42..shelf.23\"));
pre.shouldHave(matchText(\"customer:.*Carli.Customer\"));
pre.shouldHave(matchText(\"address:.*Wonderland.1\"));
pre.shouldHave(matchText(\"state:.*picking\"));

// page 12:24
open(\"http://localhost:42002/page/12_24\");

// page 12:25
open(\"http://localhost:42001/page/12_25\");

// page 12:26
open(\"http://localhost:42001/page/12_26\");
$(\"#task\").setValue(\"pt_o0925_1\");
$(\"#shelf\").setValue(\"shelf 42\");
$(\"#done\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_26_01:\"));

// check Warehouse
open(\"http://localhost:42001\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_26_01:\"));
for (DataEvent dataEvent : warehouse.getBuilder().getEventStore().values()) {
   warehouse.getBuilder().load(dataEvent.getBlockId());
}
modelMap = warehouse.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/warehouse12_26_01.svg\", modelMap.values());
}

open(\"http://localhost:42001\");
// check data note 12:26:02
pre = $(\"#data\");
pre.shouldHave(text(\"- pt_o0925_1:\"));
pre.shouldHave(matchText(\"code:.*pt_o0925_1\"));
pre.shouldHave(matchText(\"from:.*shelf.42\"));
pre.shouldHave(matchText(\"state:.*shipping\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_26_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_26_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:27:01
pre = $(\"#data\");
pre.shouldHave(text(\"- o0925_1:\"));
pre.shouldHave(matchText(\"code:.*o0925_1\"));
pre.shouldHave(matchText(\"state:.*shipping\"));

// page 12:28
open(\"http://localhost:42001/page/12_28\");

// page 12:29
open(\"http://localhost:42001/page/12_29\");

// page 12:30
open(\"http://localhost:42001/page/12_30\");
$(\"#order\").setValue(\"o0925_1\");
$(\"#done\").click();

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_30_01:\"));

// check MicroShop
open(\"http://localhost:42002\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 12_30_01:\"));
for (DataEvent dataEvent : microShop.getBuilder().getEventStore().values()) {
   microShop.getBuilder().load(dataEvent.getBlockId());
}
modelMap = microShop.getBuilder().getModel().getModelMap();
if (modelMap.values().size() > 0) {
   org.fulib.FulibTools.objectDiagrams().dumpSVG(\"tmp/microShop12_30_01.svg\", modelMap.values());
}

open(\"http://localhost:42002\");
// check data note 12:30:02
pre = $(\"#data\");
pre.shouldHave(text(\"- o0925_1:\"));
pre.shouldHave(matchText(\"code:.*o0925_1\"));
pre.shouldHave(matchText(\"state:.*delivered\"));

// page 12:32
open(\"http://localhost:42001/page/12_32\");

// workflow OutOfStock

// create ProductOrderedEvent: product ordered
ProductOrderedEvent e1301 = new ProductOrderedEvent();
e1301.setId(\"13:01\");
publish(e1301);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_01:\"));

// create OrderRejectedEvent: order rejected
OrderRejectedEvent e1302 = new OrderRejectedEvent();
e1302.setId(\"13:02\");
publish(e1302);

open(\"http://localhost:42000\");
pre = $(\"#history\");
pre.shouldHave(text(\"- 13_02:\"));
try {
   Thread.sleep(3000);
} catch (Exception e) {
}
eventBroker.stop();
warehouse.stop();
microShop.stop();

System.out.println();
"
  modified: 	false
  modifiers: 	public
  name: 	MicroShop
  paramsString: 	""
  returnType: 	void
  signature: 	"class/TestMicroShop/method/MicroShop()"

- testMicroShop_publish: 	org.fulib.classmodel.FMethod
  annotations: 	""
  clazz: 	testMicroShop
  declaration: 	"public void publish(Event event)"
  id: 	TestMicroShop_publish
  methodBody: 	"String yaml = Yaml.encodeSimple(event);

try {
   HttpResponse<String> response = Unirest.post(\"http://localhost:42000/publish\")
         .body(yaml)
         .asString();
         Thread.sleep(200);
}
catch (Exception e) {
   e.printStackTrace();
}"
  modified: 	false
  modifiers: 	public
  name: 	publish
  paramsString: 	"Event event"
  returnType: 	void
  signature: 	"class/TestMicroShop/method/publish(Event)"

